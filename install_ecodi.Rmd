---
title: "ecoDI package 설치"
description: |
  **ecoDI** package는 **ecoDI Manager를 구성하는 server-side function 기능**을 수행합니다. 이 기능은 데이터를 수집/가공/정제/활용하는 일련의 기능을 제공합니다. 이 페이지에서는 **AWS EC2 환경에 ecoDI package를 설치하는 방법**을 다룹니다.
site: distill::distill_website
output:
  distill::distill_article:
    toc: true
    toc_depth: 3  
author:
  - name: 유충현 
    url: https://choonghyunryu.github.io/
    affiliation: 디플래닉스 DS
    affiliation_url: https://www.dplanex.com/    
date: "`r Sys.Date()`"  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


# 설치 환경

본 패키지는 AWS EC2 크롤러 서버에 설치함을 전제로 설명합니다.

AWS EC2 정보는 다음과 같습니다.:

- 인스턴스명: prd-extdata-crawler-ec2-new
- 인스턴스 ID: i-0fcad0ec03eff8831
- 퍼블릭 IPv4 주소: 3.39.196.148

<br>

```{r digital, echo=FALSE, out.width = "70%", fig.align='center'}
knitr::include_graphics("img/aws_crawler.png")
```

<br>


# ecoDI 패키지 설치

`환경 설정` 페이지의 리소스를 사전에 설치하였다는 것을 전제로 합니다.
만약 이를 수행하지 않았다면, [설정 페이지](environments.html)를 참고하여 사전 설정을 완료하시기 바랍니다.

## 지리정보를 위한 설정

ecoDI 패키지는 `sf` 패키지에 종속성이 있는데, 이 패키지는 지리정보 시스템 관련 유틸리티와 몇 개의 R 패키지를 필요로 합니다.
이들을 설정하는 방법을 다룹니다.

### gdal 설치

`gdal` 유틸리티가 필요합니다. 다음처럼 `gdal`를 다운로드하여 설치합니다.

#### 사전 준비

먼저 시스템이 최신 버전인지 확인하고 필요한 빌드 도구와 종속성 있는 유틸리티를 설치합니다. 

```bash
sudo dnf update -y
sudo dnf install -y gcc gcc-c++ make cmake curl python3 python3-devel
# Install other required dependencies for GDAL, e.g., proj, geos, sqlite3, etc.
sudo dnf install -y proj-devel geos-devel sqlite-devel pcre-devel libxml2-devel openjpeg2-devel libpng-devel libtiff-devel zlib-devel
```

#### 컴파일 단계

1. 소스 코드 다운로드:

```bash
cd ~
wget https://github.com/OSGeo/gdal/releases/download/v3.8.3/gdal-3.8.3.tar.gz
```

2. 압축 해제:

```bash
tar xvzf gdal-3.8.3.tar.gz
cd gdal-3.8.3/
```

3. 구성 및 설치:

```bash
mkdir build
cd build
cmake .. # Or use specific flags, e.g., cmake -DGDAL_BUILD_OPTIONAL_DRIVERS=OFF ..
make -j$(nproc)
```

4. 설치:

```bash
sudo make install
```

5. 설치 확인

```bash
sh-5.2$ gdalinfo --version
GDAL 3.8.3, released 2024/01/04 (debug build)
sh-5.2$
```

### geos 설치

`geos-config` 유틸리티가 필요합니다. 다음처럼 `geos`를 다운로드하여 설치합니자.

```bash
wget https://download.osgeo.org/geos/geos-3.12.3.tar.bz2
tar -xvf geos-3.12.3.tar.bz2
cd geos-3.12.3

./configure --prefix=/usr/local/geos
make
sudo make install

sudo ln -s /usr/local/geos/bin/geos-config /usr/local/bin/geos-config
```

### udunits2 설치

`udunits2` 유틸리티가 필요합니다. 다음처럼 `udunits2`를 다운로드하여 설치합니다. 
이 유틸리티는 `units` 패키지 설치에 필요합니다.

> https://gist.github.com/MichaelChirico/fb697a2be62f4c7b9cffbc2316494b2e 사이트를 참고했습니다.

```bash
wget https://downloads.unidata.ucar.edu/udunits/udunits-2.2.28.tar.gz
tar -xvzf udunits-2.2.28.tar.gz
cd udunits-2.2.28

./configure CFLAGS="-fno-exceptions" --prefix=/usr/local 
make
sudo make install
sudo ldconfig

export UDUNITS_ROOT=/usr/local
export LD_LIBRARY_PATH=$UDUNITS_ROOT/lib:$LD_LIBRARY_PATH
```

### R 패키지 설치

관련된 몇 개의 R 패키지를 설치합니다.

#### units 패키지 설치

`units` 패키지를 설치합니다. shell에서 다음과 같이 실행합니다.

```bash
git clone https://github.com/r-quantities/units.git
cd units

R CMD INSTALL . --configure-args="--with-udunits2-include=$UDUNITS_ROOT/include --with-udunits2-lib=$UDUNITS_ROOT/lib"
```

#### sf 패키지 설치

다음처럼 R 콘솔에서 `sf` 패키지를 설치합니다.

```r
install.packages("sf")
```

## Git 설정 및 ecoDI 패키지 클론

ecoDI 패키지는 GitHub 저장소로부터 클론합니다. 이를 위해 Git 사용자 정보를 설정합니다.

```bash
git config --global user.name "Choonghyun Ryu"
git config --global user.email "choonghyun.ryu@gmail.com"

git clone https://github.com/choonghyunryu/ecoDI.git ecoDI
```

## ecoDI 패키지 설치

ecoDI 패키지는 로컬 소스 파일로부터 다음과 같이 설치합니다.

```r
install.packages("~/ecoDI", repos = NULL, type = "source")
```

## 지도 시각화 패키지 설치

ecoDI 패키지는 `bitSpatial` 패키지를 필요로 하지 않지만, 향후 수집한 지역 기반의 데이터 시각화를 위해 `bitSpatial` 패키지를 설치합니다.

```r
devtools::install_github("bit2r/bitSpatial")
```
